---
aliases:
дата создания: 2024-07-03
tags:
  - Программирование
cssclasses:
---
---
# что такое ORM ?

 **ORM** - (Object Relational Mapping) - это **механизм взаимодействия с таблицами базы данных**, путем внутреннего **преобразования языка программирования в SQL язык**.

# Что такое ORM в Django?

ORM в Django - это встроенный комплекс инструментов для работы с базой данных в фреймворке Django, он включает в себя множество инструментов такие как:
- Менеджеры (**objects**)
- в **моделях приложения** (models.py)
- в **админке** (admin.py)
- в **представлениях** (views.py) для получения и обработки данных
- в **тестах**, **сигналах**, **формах**, **REST-API**

>[!hint] Для создания модели нужно создать класс, наследующий `models.Model`.
>```python
>from django.db import models
>
>class Book(models.Model):
>    title = models.CharField(max_length=100)
>    author = models.CharField(max_length=50)
>    published = models.DateField()
>```
>После миграции Django автоматически создаст таблицу `app_book` в базе данных.

>[!attention] стоит запомнить
>ORM не создаст таблицу "сама по себе".  
>Важно указать подключение к базе данных в `settings.py`, иначе модели не смогут быть применены.

# Работа с ORM в Django

>[!info] Для работы с orm выделено несколько инструментов:

>[!important] ### 1. Менеджер объектов
>**Менеджер объектов** — это **основной** интерфейс между моделью и базой данных., предоставляющий доступ к методам: создания, выполнения запросов.

---

>[!attention] Внимание
>**objects** - является главным и основным инструментом работы с django, именно через него будут проходить все запросы связанные с базой данных

---

>[!example] Пример использования некоторых методов `objects`
>```python
>Book.objects.all()        # Получить все записи
Book.objects.filter(...)  # Отфильтровать записи
Book.objects.create(...)  # Создать запись
>```
Менеджер `objects` возвращает **QuerySet** — ленивый объект, который формирует SQL-запрос только при обращении к данным. то есть специальный объект, который описывает будущий SQL-запрос.


>[!note] ### Ленивость QuerySet  
>Важно понимать, что `QuerySet` **ленивый** — это значит, что при его создании **запрос к базе ещё не выполняется**.  
>Django лишь формирует описание того, _что именно нужно получить_.
>
>Запрос будет выполнен **только при обращении к данным**, например:
>
>- при **итерации**:
>```python
>for book in Book.objects.all():
>    print(book.title)
>```
>- при **преобразовании в список**:
>```python
>list(Book.objects.all())
>```
>- при **доступе к элементу**:
>```python
>Book.objects.all()[0]
>```
>- при **вызове методов, возвращающих результат**:
>```python 
>Book.objects.count()
>Book.objects.exists()
>Book.objects.first()
>```
>
>Благодаря ленивости Django может:
>- комбинировать фильтры без лишних запросов;
>- переиспользовать один `QuerySet` в разных местах;
>- выполнять SQL только тогда, когда это действительно нужно.


---

>[!important] ### 2. CRUD-операции через ORM
>**CRUD** — это четыре базовых типа операций с данными:
>
>---
>Create — создание записи
>```python
>book = Book.objects.create(
>    title="Преступление и наказание",
>    author="Ф. Достоевский",
>    published="1866-01-01"
>)
>```
>---
>Read — чтение данных.
>```python
>Book.objects.all()                     # Все книги
>Book.objects.filter(author="Пушкин")   # Только Пушкина
>Book.objects.get(id=1)                 # Конкретная запись
>```
>---
>Update — обновление записи
>```python
>book = Book.objects.get(id=1)
>book.title = "Преступление и наказание (новое издание)"
>book.save()
>```

>[!success] Плюсы CRUD
>- независима от конкретной СУБД 
>- хорошо оптимизирует запросы по скорости управления и чистоте обращений
>- защищает БД от sql инъекций
>- простота построений sql запросов

---

>[!question] #### Как пользоваться?
>для того что бы воспользоваться ей в консоли открываем оболочку django, командой: `python manage.py shell` и
  импортируем из приложения нашу модель, где мы указали метаданные таблицы.
  >```python
>>>> from app_name.models import Model
>>>> a = Model(# keywords here!)
>>>> a
><Model: Model object (None # идентификатор)>
>>>> a.save()
>>>> a
><Model: Model object (1)>
>```
>> для упрощения работы в консоли можно использовать такие библиотеки как: ipython и extensions 

## Методы `objects`

Менеджер `objects` предоставляет множество **встроенных методов**, позволяющих строить SQL-запросы декларативно и гибко.

> [!tip]  
> Полная таблица методов можно посмотреть тут - [[Методы ORM, работающие в базе данных]], [[Методы ORM, работающие вне базы данных]], [[Django objects methods]]


>[!tldr] # Вывод
>ORM является основополагающим и важнейшим инструментом при работе с базой данных в django. 
>Понимание того как он работает, даст, ограниченные только самой концепцией, возможности работы с базой данных.
>Менеджер в свою очередь является немало важной концепцией, он становится посредником между программой и базой данных позволяя управлять данными декларативно и гибко.












