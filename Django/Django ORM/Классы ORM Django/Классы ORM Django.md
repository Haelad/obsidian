Django ORM –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é **–Ω–µ –≤ Python, –∞ –ø—Ä—è–º–æ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö**.
–î–ª—è —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –∫–ª–∞—Å—Å—ã –≤—ã—Ä–∞–∂–µ–Ω–∏–π (`F`, `Case`, `When`, `Q` –∏ –¥—Ä.), –∫–æ—Ç–æ—Ä—ã–µ –ø–µ—Ä–µ–≤–æ–¥—è—Ç—Å—è –≤ SQL.

>[!important] –≠—Ç–æ –≤–∞–∂–Ω–æ, –ø–æ—Ç–æ–º—É —á—Ç–æ:
—É–º–µ–Ω—å—à–∞–µ—Ç—Å—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤; –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ª–∏—à–Ω–∏–µ –¥–∞–Ω–Ω—ã–µ; –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –±—ã—Å—Ç—Ä–µ–µ (–Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –°–£–ë–î).
 –í—Å–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –º–æ–∂–Ω–æ —Ä–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:
**–∞—Ä–∏—Ñ–º–µ—Ç–∏–∫–∞ –∏ –ø–æ–ª—è** ‚Äî –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –≤–Ω—É—Ç—Ä–∏ SQL;  **—É—Å–ª–æ–≤–∏—è –∏ –ª–æ–≥–∏–∫–∞** ‚Äî –≤—ã—Ä–∞–∂–µ–Ω–∏—è `CASE`, `WHEN`, `Q`;
**–∞–≥—Ä–µ–≥–∞—Ü–∏—è** ‚Äî —Ñ—É–Ω–∫—Ü–∏–∏ `COUNT`, `SUM`, `AVG` –∏ –¥—Ä.; **–ø–æ–¥–∑–∞–ø—Ä–æ—Å—ã** ‚Äî `Subquery`, `OuterRef`; 
** SQL-—Ñ—É–Ω–∫—Ü–∏–∏** ‚Äî —Ä–∞–±–æ—Ç–∞ —Å –¥–∞—Ç–∞–º–∏, —Å—Ç—Ä–æ–∫–∞–º–∏ –∏ –≤—Ä–µ–º–µ–Ω–µ–º.

| üß© –ö–ª–∞—Å—Å / –§—É–Ω–∫—Ü–∏—è                       |                    üí¨ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                     | üíª –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è                                                    | ‚öôÔ∏è –†–µ–∑—É–ª—å—Ç–∞—Ç / SQL-–∞–Ω–∞–ª–æ–≥                                  |
| ---------------------------------------- | :--------------------------------------------------: | -------------------------------------------------------------------------- | ---------------------------------------------------------- |
| **`F()`**                                |             –°—Å—ã–ª–∫–∞ –Ω–∞ –¥—Ä—É–≥–æ–µ –ø–æ–ª–µ –º–æ–¥–µ–ª–∏             | `Book.objects.update(price=F('price') * 0.9)`                              | `UPDATE book SET price = price * 0.9;`                     |
| **`Q()`**                                |    –°–æ–∑–¥–∞–Ω–∏–µ —Å–ª–æ–∂–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π —Å `AND`, `OR`, `NOT`     | `Book.objects.filter(Q(price__lt=100)                                      | Q(rating__gt=4))`                                          |
| **`Case`**                               |       –£—Å–ª–æ–≤–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ (–∞–Ω–∞–ª–æ–≥ `if`/`else`)        | `Case(When(price__gte=500, then=F('price')*0.9), default=F('price'))`      | `CASE WHEN price >= 500 THEN price*0.9 ELSE price END`     |
| **`When`**                               |         –£—Å–ª–æ–≤–∏–µ –≤–Ω—É—Ç—Ä–∏ `Case` (–∞–Ω–∞–ª–æ–≥ `if`)          | `When(price__lte=100, then=Value('–¥–µ—à–µ–≤–æ'))`                               | `WHEN price <= 100 THEN '–¥–µ—à–µ–≤–æ'`                          |
| **`Value()`**                            |               –í—Å—Ç–∞–≤–∫–∞ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –≤ SQL                | `Value('–í –ø—Ä–æ–¥–∞–∂–µ', output_field=CharField())`                             | `'–í –ø—Ä–æ–¥–∞–∂–µ' AS label`                                     |
| **`Func()`**                             | SQL-—Ñ—É–Ω–∫—Ü–∏—è (LOWER, UPPER, LENGTH, COALESCE –∏ —Ç.–¥.)  | `Func(F('title'), function='UPPER')`                                       | `UPPER(title)`                                             |
| **`ExpressionWrapper()`**                | –Ø–≤–Ω–æ–µ —É–∫–∞–∑–∞–Ω–∏–µ —Ç–∏–ø–∞ –≤—ã—Ä–∞–∂–µ–Ω–∏—è (–¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π) | `ExpressionWrapper(F('price') * 0.9, output_field=DecimalField())`         | `(price * 0.9) AS discount`                                |
| **`Subquery()`**                         |            –í—Å—Ç–∞–≤–∫–∞ –ø–æ–¥–∑–∞–ø—Ä–æ—Å–∞ –≤ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ            | `Subquery(Book.objects.filter(author=OuterRef('pk')).values('title')[:1])` | `SELECT title FROM book WHERE author_id=author.id LIMIT 1` |
| **`OuterRef()`**                         |     –°—Å—ã–ª–∫–∞ –Ω–∞ –ø–æ–ª–µ –≤–Ω–µ—à–Ω–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –≤ –ø–æ–¥–∑–∞–ø—Ä–æ—Å–µ     | `OuterRef('pk')`                                                           | `author.id` (–≤ –ø–æ–¥–∑–∞–ø—Ä–æ—Å–µ)                                 |
| **`Count()`**                            |   –ü–æ–¥—Å—á—ë—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–ø–∏—Å–µ–π (–∞–≥—Ä–µ–≥–∞—Ç–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è)    | `annotate(total=Count('books'))`                                           | `COUNT(books.id)`                                          |
| **`Sum()`**                              |                 –°—É–º–º–∞ –∑–Ω–∞—á–µ–Ω–∏–π –ø–æ–ª—è                  | `annotate(total_price=Sum('price'))`                                       | `SUM(price)`                                               |
| **`Avg()`**                              |                –°—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ–ª—è                 | `annotate(avg_price=Avg('price'))`                                         | `AVG(price)`                                               |
| **`Max()` / `Min()`**                    |             –ú–∞–∫—Å–∏–º—É–º / –º–∏–Ω–∏–º—É–º –∑–Ω–∞—á–µ–Ω–∏–π              | `annotate(max_price=Max('price'))`                                         | `MAX(price)` / `MIN(price)`                                |
| **`Coalesce()`**                         |   SQL-—Ñ—É–Ω–∫—Ü–∏—è: –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–µ—Ä–≤–æ–µ –Ω–µ-NULL –∑–Ω–∞—á–µ–Ω–∏–µ    | `annotate(price=Coalesce('discount_price', 'price'))`                      | `COALESCE(discount_price, price)`                          |
| **`Concat()`**                           |             –°–∫–ª–µ–π–∫–∞ (–∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏—è) —Å—Ç—Ä–æ–∫             | `annotate(full_name=Concat('first_name', Value(' '), 'last_name'))`        | `CONCAT(first_name, ' ', last_name)`                       |
| **`TruncDate()` / `TruncMonth()`**       |         –£—Å–µ—á–µ–Ω–∏–µ –¥–∞—Ç—ã –¥–æ –¥–Ω—è / –º–µ—Å—è—Ü–∞ / –≥–æ–¥–∞         | `annotate(day=TruncDate('created_at'))`                                    | `DATE_TRUNC('day', created_at)`                            |
| **`Extract()` / `ExtractYear()` –∏ —Ç.–¥.** |       –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —á–∞—Å—Ç–∏ –¥–∞—Ç—ã (–≥–æ–¥, –º–µ—Å—è—Ü, –¥–µ–Ω—å)       | `annotate(year=ExtractYear('created_at'))`                                 | `EXTRACT(YEAR FROM created_at)`                            |
| **`Now()`**                              |              –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö               | `filter(updated_at__lt=Now())`                                             | `WHERE updated_at < NOW()`                                 |

# –°–∫–æ–º–ø–æ–Ω–æ–≤–∫–∞

|–ö–∞—Ç–µ–≥–æ—Ä–∏—è|–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã|–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ|
|---|---|---|
|üîπ **–ê—Ä–∏—Ñ–º–µ—Ç–∏–∫–∞ –∏ –ø–æ–ª—è**|`F`, `ExpressionWrapper`|–û–ø–µ—Ä–∞—Ü–∏–∏ –º–µ–∂–¥—É –ø–æ–ª—è–º–∏, –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –≤ SQL|
|üîπ **–õ–æ–≥–∏–∫–∞ –∏ —É—Å–ª–æ–≤–∏—è**|`Case`, `When`, `Q`, `Value`|–£—Å–ª–æ–≤–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è|
|üîπ **–ê–≥—Ä–µ–≥–∞—Ü–∏—è**|`Count`, `Sum`, `Avg`, `Min`, `Max`|–ü–æ–¥—Å—á—ë—Ç –∏ —Å–≤–æ–¥–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è|
|üîπ **–ü–æ–¥–∑–∞–ø—Ä–æ—Å—ã**|`Subquery`, `OuterRef`|–í–ª–æ–∂–µ–Ω–Ω—ã–µ SQL-–∑–∞–ø—Ä–æ—Å—ã|
|üîπ **–§—É–Ω–∫—Ü–∏–∏ SQL**|`Func`, `Coalesce`, `Concat`, `Trunc`, `Extract`, `Now`|–†–∞–±–æ—Ç–∞ —Å —Ñ—É–Ω–∫—Ü–∏—è–º–∏, –¥–∞—Ç–∞–º–∏, —Å—Ç—Ä–æ–∫–∞–º–∏ –∏ –≤—Ä–µ–º–µ–Ω–µ–º|


